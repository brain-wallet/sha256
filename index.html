<html>
  <head>
    <title>sha256</title>

    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <script type="module">
      // IMPORTS
      import { h, html, Component, render } from './web_modules/spux.js'
      import sha256 from './web_modules/js-sha256.js'

      // FUNCTIONS
      function getFragment () {
        return window.location.hash.substring(1)
      }

      // APP
      class App extends Component {
        // INIT
        constructor (props) {
          super(props)
          let hash = getFragment()
          let init = {
            pw: hash,
            sha256: hash ? sha256(hash) : ''
          }
          this.state = {
            pw: init.pw,
            sha256: init.sha256,
            timeTaken: 0,
            title: 'sha256'
          }
          this.handleChange = this.handleChange.bind(this)
        }

        // EVENTS
        /**
         * handle all form changes
         *
         * @param {*} e
         * @memberof Body
         */
        async handleChange (e) {
          // console.log(e)
          let startTime = new Date().getTime()

          // calculate sha256
          let pw = event.target.value
          var res = sha256(pw)

          // benchmark
          var timeTaken = new Date().getTime() - startTime

          // update state
          this.setState({
            pw: pw,
            sha256: res,
            timeTaken: timeTaken
          })
        }

        // RENDER
        render (props, state) {
          // COMPONENTS

          // sha 256 input box

          // const Nav = props => {
          //   return h(
          //     'div',
          //     { className: ' bg-success white ph2 pv2 nav' },
          //     NavItem(1, props.title)
          //   )
          // }

          // navbar
          const Nav = props => {
            return html`
              <div class="bg-success white ph2 pv2 nav">
                <${NavItem} cols="1" text="${props.title}" />
              </div>
            `
          }

          // const NavItem = (cols, text) => {
          //   return h('div', { className: 'col' + ' ' + cols }, text)
          // }

          // navbar item
          const NavItem = props => html`
            <div class="col ${props.cols}">${props.text}</div>
          `

          // const Sha256Input = h('input', {
          //   placeholder: 'sha256',
          //   className: 'card w-100',
          //   value: this.state.sha256,
          //   disabled: true
          // })

          // sha 256 input
          const Sha256Input = () =>
            html`
              <input
                placeholder="sha256"
                class="card w-100"
                disabled
                value="${this.state.sha256}"
              />
              ;
            `

          const PwInput = () =>
            h('input', {
              placeholder: 'passphrase',
              className: 'card w-100',
              onInput: this.handleChange,
              value: this.state.pw,
              autoFocus: true,
              key: 'PwInput'
            })

          // const PwInput = () => {
          //   return html`
          //     <input
          //       placeholder="passphrase"
          //       class="card w-100"
          //       autofocus="true"
          //       value=${this.state.pw}
          //       onInput=${this.handleChange}
          //       key="PwInput"
          //     />
          //     ;
          //   `
          // }

          // form
          const Form = () => {
            return h(
              'div',
              { className: 'row', key: Math.random },
              PwInput(),
              Sha256Input(),
              h('sub', null, 'Time: ' + this.state.timeTaken + 'ms')
            )
          }

          // const Form = props =>
          //   html`
          //     <div class="row" key="${Math.random()}">
          //       <${PwInput} />
          //       <${Sha256Input} />
          //       <sub>${'Time: ' + this.state.timeTaken + 'ms'}</sub>
          //     </div>
          //   `

          const Main = () => {
            return h('div', null, Nav({ title: this.state.title }), Form())
          }

          // const Main = () => {
          //   return html`
          //     <div><${Nav} title="${this.state.title}" /><${Form} /></div>
          //   `
          // }

          // main
          // console.log(PwInput)
          return Main()

          // // main
          // return html`
          //   <div><${Form} /></div>
          // `
        }
      }

      render(h(App), document.body)
    </script>
  </body>
</html>
