<html>
  <head>
    <title>sha256</title>

    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <script type="module">
      // IMPORTS
      import { h, Component, render } from 'https://unpkg.com/preact?module'

      // FUNCTIONS
      /**
       * Gets sha256 string from string
       *
       * @param {string} str - A string to be hashed
       * @returns {Promise <string>} A promise of a sha256 hash of that string
       */
      async function sha256 (str) {
        var bytes = new TextEncoder('utf-8').encode(str)
        const buf = await crypto.subtle.digest('SHA-256', bytes)
        return Array.prototype.map
          .call(new Uint8Array(buf), x => ('00' + x.toString(16)).slice(-2))
          .join('')
      }

      // APP
      class App extends Component {
        // INIT
        constructor (props) {
          super(props)
          this.state = {
            pw: '',
            sha256: '',
            timeTaken: 0,
            title: 'sha256'
          }
          this.handleChange = this.handleChange.bind(this)
        }

        // EVENTS
        /**
         * handle all form changes
         *
         * @param {*} e
         * @memberof Body
         */
        async handleChange (e) {
          let startTime = new Date().getTime()

          // calculate sha256
          let pw = event.target.value
          var res = await sha256(pw)

          // benchmark
          var timeTaken = new Date().getTime() - startTime

          // update state
          this.setState({
            pw: pw,
            sha256: res,
            timeTaken: timeTaken
          })
        }

        // RENDER
        render (props, state) {
          return h(
            'div',
            { className: 'row' },
            h(
              'div',
              { className: '6 col' },
              h(
                'div',
                null,
                h('h1', null, this.state.title),
                h('input', {
                  placeholder: 'passphrase',
                  className: 'card w-100',
                  onChange: this.handleChange,
                  onKeyUp: this.handleChange,
                  value: this.state.pw,
                  name: 'pw',
                  autoFocus: true
                }),
                h('input', {
                  placeholder: 'sha256',
                  className: 'card w-100',
                  value: this.state.sha256
                }),
                h('h1'),
                h('span', null, 'Time taken: ' + this.state.timeTaken + 'ms')
              )
            )
          )
        }
      }

      render(h(App), document.body)
    </script>
  </body>
</html>
