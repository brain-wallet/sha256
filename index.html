<html>
  <head>
    <title>sha256</title>

    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <script type="module">
      // IMPORTS
      import { h, Component, render } from './web_modules/solidpay-ui.js'
      import sha256 from './web_modules/js-sha256.js'

      // APP
      class App extends Component {
        // INIT
        constructor (props) {
          super(props)
          let hash = window.location.hash.substring(1)
          let init = {
            pw: hash,
            sha256: hash ? sha256(hash) : ''
          }
          this.state = {
            pw: init.pw,
            sha256: init.sha256,
            timeTaken: 0,
            title: 'sha256'
          }
          this.handleChange = this.handleChange.bind(this)
        }

        // EVENTS
        /**
         * handle all form changes
         *
         * @param {*} e
         * @memberof Body
         */
        async handleChange (e) {
          let startTime = new Date().getTime()

          // calculate sha256
          let pw = event.target.value
          var res = sha256(pw)

          // benchmark
          var timeTaken = new Date().getTime() - startTime

          // update state
          this.setState({
            pw: pw,
            sha256: res,
            timeTaken: timeTaken
          })
        }

        // RENDER
        render (props, state) {
          //components
          const sha256Input = () => {
            return h('input', {
              placeholder: 'sha256',
              className: 'card w-100',
              value: this.state.sha256,
              disabled: true
            })
          }

          const pwInput = () => {
            return h('input', {
              placeholder: 'passphrase',
              className: 'card w-100',
              onChange: this.handleChange,
              onKeyUp: this.handleChange,
              value: this.state.pw,
              name: 'pw',
              autoFocus: true
            })
          }

          const nav = title => {
            return h(
              'div',
              { className: ' bg-success white ph2 pv2 nav' },
              navItem(1, title)
            )
          }

          const navItem = (cols, text) => {
            return h('div', { className: 'col' + ' ' + cols }, text)
          }

          const form = () => {
            return h(
              'div',
              { className: 'row' },
              pwInput(),
              sha256Input(),
              h('sub', null, 'Time: ' + this.state.timeTaken + 'ms')
            )
          }

          // main
          return h('div', null, nav(this.state.title), form())
        }
      }

      render(h(App), document.body)
    </script>
  </body>
</html>
