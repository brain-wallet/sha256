<html>
  <head>
    <title>sha256</title>

    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <script type="module">
      // imports
      import { h, Component, render } from 'https://unpkg.com/preact?module'
      import htm from 'https://unpkg.com/htm@3.0.4/dist/htm.module.js'

      /**
       * Gets sha256 string from string
       *
       * @param {string} str - A string to be hashed
       * @returns {Promise <string>} A promise of a sha256 hash of that string
       */
      async function sha256 (str) {
        var bytes = new TextEncoder('utf-8').encode(str)
        const buf = await crypto.subtle.digest('SHA-256', bytes)
        return Array.prototype.map
          .call(new Uint8Array(buf), x => ('00' + x.toString(16)).slice(-2))
          .join('')
      }

      /**
       * Hex to bytes
       *
       * @param {string} str A hex string
       * @returns {int[]} An array of bytes
       */
      function hexToBytes (str) {
        var result = []
        while (str.length >= 2) {
          result.push(parseInt(str.substring(0, 2), 16))
          str = str.substring(2, str.length)
        }
        return result
      }

      const html = htm.bind(h)

      const title = 'sha256'

      function SomePreactComponent (props) {
        return html`
          <h1 style="color: red">Hello, World!</h1>
        `
      }

      /** Example classful component */
      class App extends Component {
        constructor (props) {
          super(props)
          this.state = {
            pw: '',
            sha256: '',
            timeTaken: 0
          }
          this.handleChange = this.handleChange.bind(this)
        }

        /**
         * handle all form changes
         *
         * @param {*} e
         * @memberof Body
         */
        async handleChange (e) {
          console.log(e)
          pw = event.target.value

          let startTime = new Date().getTime()
          var pw
          var target = e.target
          if (e.target) {
            var name = e.target.name
          }

          var res = await sha256(pw)

          // benchmark
          var timeTaken = new Date().getTime() - startTime
          console.log('timeTaken', timeTaken)

          // update state
          this.setState({
            pw: pw,
            sha256: res,
            timeTaken: timeTaken
          })
        }

        componentDidMount () {
          this.setState({ message: title })
        }
        render (props, state) {
          return h(
            'div',
            { className: 'row' },
            h(
              'div',
              { className: '6 col' },
              h(
                'div',
                { id: 'app' },
                h('h1', null, this.state.message),
                h('input', {
                  placeholder: 'passphrase',
                  className: 'card w-100',
                  onChange: this.handleChange,
                  onBlur: this.handleChange,
                  onKeyUp: this.handleChange,
                  value: this.state.pw,
                  name: 'pw',
                  autoFocus: true
                }),
                h('input', {
                  placeholder: 'sha256',
                  className: 'card w-100',
                  value: this.state.sha256
                }),
                h('h1'),
                h('span', null, 'Time taken: ' + this.state.timeTaken + 'ms')
              )
            )
          )
        }
      }

      render(h(App), document.body)
    </script>
  </body>
</html>
